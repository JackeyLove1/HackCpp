# 29.4 原生字符串字面量

过去想在C++中嵌入一段带格式和特殊符号的字符串是一件非常令人头痛的事情，比如在程序中嵌入一份HTML代码，我们不得不写成这样：

```javascript
char hello world html[] = "<!DOCTYPE html>\r\n"  
"<html lang = ''en''\r\n"  
" <head>\r\n"  
" <meta charset = ''utf-8''\r\n"  
" <meta name = ''viewport'' content = ''width=device-width, initial-scale=1, user-scalable=yes''\r\n"  
" <title>Hello World!/title>\r\n"  
" </head>\r\n"  
" <body>\r\n"  
" Hello World!\r\n"  
" </body>\r\n"  
</html>\r\n";
```

可以看到上面代码里的字符串非常难以阅读和维护，这是因为它包含的大量转义字符影响了阅读的流畅性。为了解决这种问题，C++11标准引入原生字符串字面量的概念。

原生字符串字面量并不是一个新的概念，比如在Python中已经支持在字符串之前加R来声明原生字符串字面量了。使用原生字符串字面量的代码会在编译的时候被编译器直接使用，也就是说保留了字符串里的格式和特殊字符，同时它也会忽略转移字符，概括起来就是所见即所得。

声明原生字符串字面量的语法很简单，即prefixR" delimiter(rawCharacters) delimiter"，这其中prefix和 delimiter是可选部分，我们可以忽略它们，所以最简单的原生字符串字面量声明是R"(raw Characters)"。以上面的HTML字符串为例：

```html
char hello_world_html[] = R"(<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width device-width, initial-scale=1, user-scalable=yes"> <title>Hello World!/ </title> </head> <body> Hello World! </body> </html>
```

从上面的代码可以看到，原生字符串中不需要\r\n，也不需要对引号使用转义字符，编译后字符串的内容和格式与代码里的一模一

样。读者在这里可能会有一个疑问，如果在声明的字符串内部有一个字符组合正好是)”，这样原生字符串不就会被截断了吗？没错，如果出现这样的情况，编译会出错。不过，我们也不必担心这种情况， $\mathrm{C} + + 11$  标准已经考虑到了这个问题，所以有了delIMITER（分隔符）这个元素。delIMITER可以是由除括号、反斜杠和空格以外的任何源字符构成的字符序列，长度至多为16个字符。通过添加delIMITER可以改变编译器对原生字符串字面量范围的判定，从而顺利编译带有)”的字符串，例如：

```txt
char hello_world_html[] = R"cpp(<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width  $\equiv$  device-width, initialscale  $= 1$  ,user-scalable  $\equiv$  yes"> <title>Hello World!</title> </head> <body> "(Hello World!)" < / body > < / html> )cpp";
```

在上面的代码中，字符串虽然包含"(Hello World!)"这个比较特殊的子字符串，但是因为我们添加了cpp这个分隔符，所以编译器能正确地获取字符串的真实范围，从而顺利地通过编译。

C++11标准除了让我们能够定义char类型的原生字符串字面量外，对于wchar_t、char8_t（C++20标准开始）、char16_t和char32_t类型的原生字符串字面量也有支持。要支持这4种字符类

型，就需要用到另外一个可选元素prefix了。这里的prefix实际上是声明4个类型字符串的前缀L、u、U和u8。

```c
char8_t utf8[] = u8R" (你好世界) "; // C++20标准开始  
char16_t utf16[] = uR" (你好世界) ";  
char32_t utf32[] = UR" (你好世界) ";  
wchar_t wstr[] = LR" (你好世界) ";
```

最后，关于原生字符串字面量的连接规则实际上和普通字符串字面量是一样的，唯一需要注意的是，原生字符串字面量除了能连接原生字符串字面量以外，还能连接普通字符串字面量。

