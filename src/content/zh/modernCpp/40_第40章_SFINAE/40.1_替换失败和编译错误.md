# 40.1 替换失败和编译错误

SFINAE（Substitution Failure Is Not An Error，替换失败不是错误）主要是指在函数模板重载时，当模板形参替换为指定的实参或由函数实参推导出模板形参的过程中出现了失败，则放弃这个重载而不是抛出一个编译失败。它是模板推导的一个特性，虽然在C++03标准中没有明确禁止它，但是那时该特性并没有在标准中明确规定哪些符合SFINAE，哪些应该抛出编译错误。这样，也就很少有编译器会支持它，毕竟这个特性的开发代价可不小。有一些看起来顺理成章的代码却是无法通过编译的。比如提案文档中的这个例子：

```txt
template <int I> struct X {};
char foo(int);
char foo(float);
template <class T> X sizeof.foo((T) 0)) > f(T)
{
    return X sizeof.foo((T) 0)) >();
}
int main()
{
    f(1);
}
```

上面的代码在不支持C++11的编译器上很有可能是无法成功编译的（请注意，该例子要使用GCC4.3之前的版本编译，因为GCC4.3已

经逐步开始支持  $\mathrm{C} + + 0 \mathrm{x}$  )。主要原因是编译器无法推导像

sizeof(foo((T)0))这样的表达式。虽然在我们看来这是一个简单的表达式，但是要让编译器处理它可不容易，何况当时还没有明确的标准。这种情况明显地限制了C++模板的推导能力，所以在C++11标准中明确规范了SFINAE规则，可以发现上面的代码在任何一个支持C++11的编译器中都能顺利地编译通过。

