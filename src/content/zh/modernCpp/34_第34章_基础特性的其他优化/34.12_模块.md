# 34.12 模块（C++20）

模块（module）是C++20标准引入的一个新特性，它的主要用途是将大型工程中的代码拆分成独立的逻辑单元，以方便大型工程的代码管理。模块能够大大减少使用头文件带来的问题，例如在使用头文件时经常会遇到宏和函数的重定义，而模块则会好很多，因为宏和未导出名称对于导入模块是不可见的。使用模块也能大幅提升编译效

率，因为编译后的模块信息会存储在一个二进制文件中，编译器对于它的处理速度要远快于单纯使用文本替换的头文件方法。可惜到目前为止并没有主流编译器完全支持该特性，所以这里只做简单介绍：

```cpp
// helloworld.ioxx   
export module helloworld;   
import std.core;   
export void hello() { std::cout << "Hello world!\n"; }   
// modules_test.cpp   
import helloworld;   
int main() { hello();
```

上面的代码很容易理解，helloworld.ixx是接口文件，它将编译成一个名为helloworld的导出模块。在模块中使用import引入了std.core，std.core是一个STL模块，包含了STL中最主要的容器和算法。除此之外，模块还使用export导出了一个hello函数。编译器编译helloworld.ixx会生成一个helloworld.ifc，该文件包含了模块的元数据。modules_test.cpp可以通过importhelloworld;导入helloworld模块，并且调用它的导出函数hello。

在使用VS 2019进行编译时有两点需要注意。

1. 在安装VS 2019的C++环境时勾选模块（默认不勾选）。如果不做这一步，会导致import std.core;无法正确编译。

2. 编译选项开启/experimental:module。

